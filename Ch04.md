# 第四章 创建图片管理桌面应用



本章使用 `Vue` 的 `Electron` 插件来构建一个跨平台的（`cross-platform`）图片管理桌面应用。该应用可以快速实现本地图片的增删改查操作，同时提供了基于 `JSON` 的简易后端 `API`，可以作为原型设计时快速搭建后端服务器的小工具。



相关主题如下：

- `Vue` 组件的再理解
- 用 `Vue CLI` 插件 `Electron Builder` 创建项目
- 新增图片提交用户界面（UI）
- 新增图片展示页
- 为应用新增路由功能
- 为应用添加后端 `API` 接口



---



## 1 Vue 组件的再理解

组件（`Components`）可以包含很多内容，通过 `props` 从父组件接收数据来自定义组件行为。此外，组件也能通过计算属性及监视器（`watchers`）来监听响应式数据；还能使用 `methods` 定义方法来完成相应操作；组件的内置指令（`built-in directives`）还能用于 `DOM` 操作及数据绑定。总地来说，组件要设计得简洁高效，不应放入过多内容，包含少量的元素或子组件即可。

此外，组件也不是万能的。仅凭几个组件并且无法使用 `URL` 导航，是不可能构建任何较复杂的应用的。如果一个应用只包含组件，则只能通过组件嵌套来控制复杂度；但嵌套组件越多，内部导航也会越困难。目前大多数应用都有不同的页面，如果不引入路由机制，就不可能实现导航。

`Vue` 提供了 `Vue Router` 模块来解决导航问题。利用 `Vue Router` 可以在跳转到一个 `URL` 时渲染指定的组件，也可以通过它提供的 `router-link` 组件来实现导航。`Vue Router` 功能强大，可以实现 `URL` 与路由（`routes`）的匹配。`URL` 可以携带查询字符串及 `URL` 参数，与 `Vue Router` 相结合还可以将路由嵌套在不同的组件中。完成 `URL` 映射的组件会出现在 `Vue Router` 的 `router-view` 组件中。对嵌套路由，需要在父级路由中添加 `router-view` 组件来显示子路由。

为了导航到不同的路由，`Vue Router` 对目前几乎所有现代浏览器都内置了的 `JavaScript History API` 进行了封装。借助这个 `API`，可以轻松地返回到不同的页面、跳转到一个历史记录或期望的 `URL` 地址。`Vue Router` 还支持 `HTML5` 模式——可以使用不带哈希符号 `#` 的 `URL` 与服务端渲染的路由作区分。

此外，`Vue Router` 还支持过渡特效（`transition effects`），可以在导航到不同路由时出现。导航跳转的链接或激活状态下的链接（`active link`）也可以设置 `CSS` 样式。





## 2 了解 Vue CLI 插件 Electron Builder

使用 `Electron` 可以将 `JavaScript` 客户端 `Web` 应用转换成桌面应用。`Vue CLI` 提供的 `Electron Builder` 插件可以让开发者在一个桌面应用环境中构建 `Vue 3` 应用。`Electron` 应用本质上是运行在一个基于 `Chromium` 内核的浏览器上的 `Web` 应用，因此浏览器能实现的功能它都能实现：有限的硬件交互（调用麦克风、摄像头）、在主流操作系统的通知栏显示原生通知等。`Electron` 旨在提供一种简易的方式从 `Web` 应用来构建桌面级应用，而无须考虑底层硬件的访问。

`Electron Builder` 是从 `Vue` 应用程序创建 `Electron` 应用程序最快的方法，因为它支持一些原生代码。利用 `Electron Builder` 还可以在代码中包含原生模块（`native modules`），只需要将 `Node.js` 模块位置引入目标原生代码中即可。此外，可以包含 **环境变量** 为不同的环境构建相应的项目。由于对 `Chromium` 的支持，`Electron Builder` 也支持 `Web worker`——可用于后台任务的运行——这样当要执行长时间运行或高 `CPU` 占用的任务时，就不必阻塞浏览器主线程。所有这些功能都可以通过常规的 `Vue` 应用或修改配置来实现。

另外，也存在一些功能是 `Electron` 支持但 `Electron Builder` 不支持的，比如原生菜单功能就不支持，但跨平台创建桌面应用就是支持的——这说明插件支持的功能也是有限的，但用于功能演示已经足够了。

本章演示的是一个运行在 `Windows` 系统的关于图片管理的桌面应用，由以下部分组成：

- 用于展示所有已添加的图片的总览页；
- 添加并保存图片的表单页；
- 专用于图片存放的存储机制；
- 使用 `Vue Router` 实现页面间的导航。

