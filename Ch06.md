# 第六章 用 PrimeVue UI 框架构建一个假期预订 APP



上一章演示了 `Vue` 在 `Ionic` 框架上构建移动端应用的具体方法，但一直还没有用过基于 `Vue` 的 `UI` 库或框架来构建 `Web` 应用；也没有建立过拥有独立后端的项目，这里的后端，就是对大多数业务系统而言都是必需的、用来专门存放数据、做用户验证、执行后台任务等等的场所。本章就将利用 `PrimeVue` 这个 `UI` 框架建立一个假期预订 `APP`：使用 `Vue3` 前端做管理后台，并用另一个前端站点供用户添加订单；还将建立一个简单的后端来校验管理员用户，然后再执行具有管理员访问权限的任务。简单起见，面向公众的前端不作身份验证。

相关主题如下：

- 用 PrimeVue UI 框架构建一个前端站点；
- 用 Express 构建一个简单的后端站点来验证用户；
- 后端用 SQLite 实现数据持久化；
- 前端使用 `Vue Router` 做身份验证（`authentication`）；
- 用 `Vee-Validate` 和 `Yup` 做表单校验；

---



## 1 PrimeVue 简介

**PrimeVue** 是一款基于 `Vue3` 的前端 `UI` 框架，适用于 `Vue3` 应用。由于相关的 `API` 接口已经发生了重大调整，其它基于 `Vue2` 的框架是运行不了 `Vue3` 应用的，更何况 `Vue3` 的底层代码也和 `Vue2` 相去甚远。`PrimeVue` 拥有大量构建 `Web` 应用的通用组件，如文本框、按钮、菜单栏、表格等，还以主题的形式预设了不少样式，可以直接使用其内置组件进行开发。由于是为 `Vue3` 量身打造的，代码中可以很方便地注册并使用组建、导入 `CSS` 样式等等；还能根据某个组件需要哪些组件来决定是要局部注册组件还是全局注册，功能十分强大。

`PrimeVue` 为 `input` 元素和各种文本提供了现成的样式，例如验证错误（`validation errors`）和按钮。还自带非常实用的 `flexbox` 小工具，支持使用预设的 `CSS` 样式类来轻松设置组件的位置和间距。



## 2 Vee-Validate 与 Yup 简介

从开篇到现在，我们还没有用过任何第三方库来提高表单校验的工作效率。表单验证也是绝大多数 `Web` 应用必需投入精力去考虑的方面。

`Vee-Validate 4` 就是这样一款兼容 `Vue3` 的表单验证第三方库。有了它，就能在前端创建带表单验证功能的组件。 `Vee-Validate` 校验所需的校验模式（`schema`）由另一个数据校验库 `Yup` 提供。`Vee-Validate 4` 通过 `Form` 组件和 `Field` 组件进行表单校验，具体原理是对组件进行封装并传入 `Field` 组件自带的 `slot` 属性，来作为 `props` 的值，进而实现各种 `input` 组件的校验。两者结合使用效率更高，不必手动造轮子。



## 3 Express 简介

`Express` 框架用于创建一个简易后端站点来存储数据。它是一款十分简单的 `Node.js` 后端框架，可以快速搭建一个后端站点。为演示起见，选用 `SQLite` 数据库存储数据。`Express` 创建一组 `API` 接口供前端调用。前端定义相应的路由，并在其处理函数（`handlers`）中获取到请求的数据，并按业务需要做进一步处理。



## 4 前后端通信

要让前后端正常通信，需要在后端允许前端的跨域访问，这通常由 `CORS`（`Cross-Origin Resource Sharing`，跨域资源共享）中间件实现。示例将在 `Express` 应用中引入。

在 `Node.js` 环境下操作 `SQLite` 数据库是通过 `sqlite3` 库实现的，利用它可以执行 `SQL` 语句新增或删除数据库记录。

另外，`admin` 前端也要实现简单的身份验证。对管理员登录的用户名和密码进行验证，验证通过后才能发放访问令牌并发送至前端。然后，前端将使用存储在 `header` 头中的访问令牌来判定是否可以从前端发送请求。示例只对具有管理员访问权限的路由添加身份验证逻辑，因此只需要在加载它们之前进行校验即可。

令牌的创建和验证是由 `jsonwebtoken` 库实现的。利用它可以创建一个令牌并用一个 `secret` 字符串签名；同时也可以带一个 `secret` 来验证令牌的有效性。本示例会把 `jsonwebtoken` 库放到一个中间件，并令其先于路由处理函数完成相关验证工作。如果验证通过则放行，否则响应一个 `401` 状态给客户端。



## 5 创建假期预订项目