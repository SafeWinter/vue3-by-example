# 第三章 创建带测试用例的拼图益智游戏

第二章用 `Vue` 创建了一个简单的基于 `PWA` 的 `GitHub` 应用，并在上面加入了一些组件（`components`）。本章我们将创建一个简易的拼图游戏。游戏最终目标是将一堆打乱顺序的图片碎片重新还原成一张完整的图片。一旦还原成功，则提示 **大功告成**（**You Win**）。本地缓存（`local storage`）将记录用时最短的前 10 名的成绩。此外，该游戏还应该允许玩家选择不同的图片，以增加游戏的趣味性。

开发注意事项：

1. 要创建组件来控制 **本地缓存** 的读写：
   1. 读取数据后就要展示到页面上；
   2. 写入的数据仅为成绩最好的前 10 名。考虑到本地缓存 **只能存字符串**，前 10 名的数据还需要序列化后才能存入。
2. 要使用 **计时器** 来计算玩家完成拼图游戏的总用时。
3. 判定玩家是否获胜，还需要用到 **计算属性**。
4. 要为每个模块添加 **单元测试**，以自动测试每个组件。

本章涉及主题如下：

- 理解组件与混入的基本原理
- 建立 `Vue` 项目
- 创建组件以打乱图片顺序
- 由玩家来重新排列拼图
- 根据最终用时计算得分
- 使用 `Jest` 进行单元测试

---

本章示例文件：https://github.com/PacktPublishing/-Vue.js-3-By-Example/tree/master/Chapter03（详见 `demos/Chapter03`）

## 1 理解组件（`components`）及混入（`mixins`）的基本原理

`components` 组件的特性远不止第二章 `PWA` 演示项目中涉及的点（只是演示了 `components` 组件获取并展示数据的方法）。本章将在组件中使用计时器（`timers`），并演示 **计算属性**（`computed properties`） 的适用场景及具体用法，以便从其他响应式属性衍生出新的响应式属性，避免创建冗余方法，减少不必要的指令调用。

计算属性本质上是一个方法，该方法返回一个基于其他响应式数据的新值，其自身也是一个响应式数据。只要关联的响应式数据发生改变，计算属性也会同步更新加入缓存的值。利用这个特性，计算属性可用于替换复杂的模板表达式或方法，以提高效率。

组件的另一强大功能是触发自定义事件，并可携带一个或多个数据载荷（`payload`）。自定义事件的侦听通过 `v-on` 指令实现，事件携带数据的获取，可通过 `$event` 变量或事件处理函数中的参数来实现。

`Vue 3` 还有一个重要组成部分——测试。测试分多种类型，可以有效捕获各类 `bug`。测试常用于捕获回归阶段的 `bug`，即由于改动已有应用上的代码引入的 `bug`。在各类检测回归阶段的测试方法中，最常用的是单元测试（`unit test`）——通过将 **组件及其组成部分** 挂载到一个独立的测试环境来进行测试。由于各个测试模块相互独立，在任何环境、以任何顺序执行这些测试都是可行的——确保测试的便携性（`portable`）非常重要。另外，像 `API` 接口数据和 `timer` 计时器等这类涉及异步调用的外部资源，由于数据非常不稳定（`very volatile`）而难以测试。因此要确保测试中没有这类数据，测试结果才能始终保持一致。

`Vue` 支持 `Jest` 和 `Mocha` 两个 `JavaScript` 测试框架——这也是通过 `CLI` 命令行工具创建 `Vue` 项目的一大优势，不必从零开始创建测试所需的脚手架。

另一种测试是端到端测试（`end-to-end tests`）。 这些测试模拟用户如何使用应用程序，并从头开始创建测试环境来运行这些测试；每次测试要求使用的都是新数据，并且能以一种连贯的、一致的方式来运行，就需要首先提供一致的数据。

本章示例将考察单元测试在前端应用中的使用，像进行端到端测试那样完成一些简单的 `DOM` 交互。由于不必创建全新的测试环境，供演示的测试用例的执行速度都很快。通常情况下，测试环境搭建和用户交互的测试总是比单元测试要慢，因此可以采取“较多的单元测试并配合少量端到端测试”的策略，来实现示例核心功能的测试。


`components` 组件的特性远不止第二章 `PWA` 演示项目中涉及的点。第二章只是演示了 `components` 组件的最基础的用法。本章将在组件中使用计时器，而非简单的获取数据并展示。接着我们将考察计算属性的适用场景及具体用法，以便从其他响应式属性衍生出新的响应式属性，从而避免创建一些额外的方法，或调用一些不必要的指令。





## 笔误汇总

errata1: Setting up the Vue project

`.row img select` has its width set to `100px` to display a thumbnail of the whole image.

solution：`.row img` has its width set to `100px` to display a thumbnail of the whole image.



errata2: Setting up the Vue project

Also, we have the `beforeMount` hook, which lets us get the records before the component mounts.

solution: Also, we have the `created` hook, which lets us get the records before the component mounts.
