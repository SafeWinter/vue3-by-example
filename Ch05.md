# 第五章 用 Ionic 实现一个多功能计算器移动端 APP



前四章介绍了用 `Vue3` 创建 `Web` 应用的相关知识。`Vue3` 也可以创建移动端应用，但需要在以 `Vue3` 作基础框架的移动端 `APP` 框架上进行。上一章演示了 `Vue Router` 在具有多个页面的应用中完成页面导航的相关功能，可以借此实现一些稍复杂的应用了；本章将更进一步，介绍怎样用 `Vue3` 创建移动端应用。该应用的功能是汇率计算和小费计算，并支持历史记录的重算。

本章相关主题如下：

- 介绍 `Ionic Vue`
- 创建 `Ionic Vue` 移动端应用
- 安装项目所需的包
- 在计算器 APP 中添加多种计算器

---



## 1 `Ionic Vue` 简介

**`Ionic Vue`** 是一个通过 `Typescript` 和 `Vue` 来构建移动端应用的框架。`Ionic` 同样也有基于 `React` 和 `Angular` 的版本。同其他 UI 框架一样，`Ionic Vue` 内置了许多常见的组件，如 input 框、菜单、图标、列表等等。编译好的 `Ionic` 应用会在一个 `Web` 视图（`Web view`）中运行，以便在应用中方便地调用 `localStorage` 本地缓存、`geolocation` 等在内的浏览器 `API`。该框架提供的内置工具还可以自动构建移动端应用，不必手动从头开始搭建环境。

`Ionic Vue` 默认使用 `Composition API` 规范来创建组件，使得项目的模块化程度更高，能更好地和 `Typescript` 协同。



### 1.1 理解 Composition API

由于不引用动态的关键字 `this`，`Composition API` 能更好地与 `Typescript` 进行配合。`Composition API` 中的所有内容，包括它的各种库，都是函数兼容的（`compatible`）——都具有明确的参数和返回类型，可以很方便地通过 `Typescript` 进行类型定义。由于 `Vue Router 4` 和 `Vuex 4` 才与 `Composition API` 兼容，因此演示项目中也会一并引入这两个库。

`Composition API` 中也有组件对象（`component object`）的概念，但实现方式和之前的 `Options API` 完全不同，唯一相同的是都具有 `components` 属性。在 `Composition API` 中，组件逻辑是在 `setup()` 方法中实现的——这里也是定义响应式属性、计算属性、侦听器及组件方法的地方。项目需要的第三方库是以 `hooks` 钩子的形式出现的，所谓钩子就是可以在 `setup` 函数中直接调用的第三方库函数，例如通过 `Vuex 4` 提供的 `useStore` 钩子来访问 `store`；用 `Vue Router 4` 提供的 `useRouter` 钩子来实现导航。

此外，`Composition API` 定义响应式属性和计算属性的方式也和之前的 `Options API` 大不相同——

- 响应式数据的定义：前面章节中演示的是 `options API` 的用法，响应式数据的初始化是在 `data()` 方法中进行的；而在 `Composition API` 中，基本类型的值（`primitive values`）对应的响应式数据，需要用 `ref` 函数定义；而对象型值的响应式数据需要调用 `reactive` 方法来完成；
- 计算属性的定义：通过 `computed` 函数来定义，需要传入一个回调函数。该函数引用了其他响应式数据生成对应的计算属性；
- 侦听器的定义：通过 `watch` 函数来定义，需要一个回调函数。该函数的返回值是一个期望被侦听的响应式数据。回调函数的第一个参数是最新的值，第三个参数是该侦听器的配置对象，可以像在 `Options API` 中那样设置 `deep` 属性和 `immediate` 属性等；
- 组件方法的定义：也在 `setup` 函数内进行；由于没有 `this` 的限制，用箭头函数还是普通函数定义方法均可；

这些响应式数据及方法必须以一个对象的形式从 `setup` 函数返回，这样才能让组件模板调用。



### 1.2 理解 Typescript

**`TypeScript`** 是微软发布的一个 `JavaScript` 的扩展，可以在编译阶段检查数据类型，但不提供其它运行时的类型检查，因为 `TypeScript` 在运行前会被编译为 `JavaScript` 代码。用 `Composition API` 创建的组件不引用 `this` 关键字，因此也不必担心用错 `this`。

使用 `TypeScript` 的好处在于它能确保类型安全，如基本类型、对象型、变量等，这是 `JavaScript` 不具备的。`JavaScript` 可以将任意值赋值给一个变量，这样在不希望数据类型发生改变时就会出问题；同时，函数也能接收任意值作参数，没有参数数量与传参顺序的限制，从而很可能在传入无效参数时报错；再者，参数在任意位置都可能为 `null` 或 `undefined`，而我们往往只希望在某些地方允许为空。类型不安全还可能发生在函数的返回值上，同样地，`TypeScript` 也能对其加以限制。

`TypeScript` 的另一个强大特性在于可以创建接口来限制对象型数据的结构。可以指定对象的属性与类型，确保目标对象具有这些符合要求的数据结构，从而避免传入指定类型以外的对象型参数；同时，这也为支持 `TypeScript` 特性的文本编辑器实现自动补全功能（`autocomplete functionality`）提供了可能——因为对象的结构是固定的。接口也支持非必填项和动态属性，以保留 `JavaScript` 对象的灵活性。

为了保留 `JavaScript` 的灵活性，`TypeScript` 提供了 `union` 和 `intersection` 类型：

- `Union` 型：通过逻辑或运算符实现对多种类型的支持，某变量值必须是备选类型之一，相当于对多种类型 **求并集**；
- `Intersection` 型：通过逻辑与运算符实现对多种类型的支持，某变量值必须同时满足所有备选类型，相当于对多种类型 **求交集**；

为了使类型定义简洁，`TypeScript` 提供了 `type` 关键字来创建类型别名。类型别名与常规类型一样，也能用于规范变量、属性、参数、返回值等的类型。

本章演示的移动端应用，会在小费计算页、汇率转换页、Home 主页添加历史计算列表。所有运行过的计算都会存入 `localStorage` 缓存以便后期调用。将操作历史存入本地缓存需要用到 `vuex-persistedstate` 插件，该插件兼容 `Vuex 4`，可以将 `Vuex state` 直接存入本地缓存，而不必手敲其他多余的代码。

在了解了 `Vue 3` 的 `Composition API`、`TypeScript` 和 `Ionic` 的相关知识后，来看看移动端应用的具体创建。







